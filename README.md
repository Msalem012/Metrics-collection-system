# –°–∏—Å—Ç–µ–º–∞ –°–±–æ—Ä–∞ –ú–µ—Ç—Ä–∏–∫

–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è, —Ä–∞—Å—à–∏—Ä—è–µ–º–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –Ω–∞ C++ –¥–ª—è —Å–±–æ—Ä–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã.

## –û–ø–∏—Å–∞–Ω–∏–µ –ü—Ä–æ–µ–∫—Ç–∞

–î–∞–Ω–Ω—ã–π –ø—Ä–æ–µ–∫—Ç –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –¥–ª—è —Å–±–æ—Ä–∞ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –≤ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –≤—Ä–µ–º–µ–Ω–∏, —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –∑–∞–¥–∞–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏ –≤ —Ñ–∞–π–ª—ã –≤ —á–µ–ª–æ–≤–µ–∫–æ-—á–∏—Ç–∞–µ–º–æ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ.

### –ó–∞–¥–∞—á–∞
–†–∞–∑—Ä–∞–±–æ—Ç–∞—Ç—å –±–∏–±–ª–∏–æ—Ç–µ–∫—É/–Ω–∞–±–æ—Ä –∫–ª–∞—Å—Å–æ–≤ –Ω–∞ C++ –¥–ª—è —Å–±–æ—Ä–∞ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç—Ä–∏–∫ –≤ —Ñ–∞–π–ª –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –≤–∏–¥–µ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º–∏:

**–ü—Ä–∏–º–µ—Ä—ã –º–µ—Ç—Ä–∏–∫:**
- –°—Ä–µ–¥–Ω—è—è —É—Ç–∏–ª–∏–∑–∞—Ü–∏—è CPU –∑–∞ —Å–µ–∫—É–Ω–¥—É (–≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —á–∏—Å–ª–∞ –æ—Ç 0 –¥–æ N, –≥–¥–µ N - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —è–¥–µ—Ä)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–Ω—è—Ç—ã—Ö HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ —Å–µ–∫—É–Ω–¥—É (—Ü–µ–ª—ã–µ —á–∏—Å–ª–∞ –æ—Ç 0 –¥–æ INT_MAX)

**–§–æ—Ä–º–∞—Ç –≤—ã–≤–æ–¥–∞:**
```
2025-06-01 15:00:01.653 "CPU" 0.97 "HTTP requests RPS" 42
2025-06-01 15:00:02.653 "CPU" 1.12 "HTTP requests RPS" 30
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
-  –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –º–µ—Ç—Ä–∏–∫ –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
-  –ó–∞–ø–∏—Å—å –º–µ—Ç—Ä–∏–∫ –Ω–µ –¥–æ–ª–∂–Ω–∞ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Ç–æ–∫–∏, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ–∏—Å—Ö–æ–¥—è—Ç —Å–æ–±—ã—Ç–∏—è
-  –ü–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏ –º–µ—Ç—Ä–∏–∫ –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–±–Ω—É–ª—è—é—Ç—Å—è

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –ü–æ–¥—Ö–æ–¥ –∫ –†–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –†–µ—à–µ–Ω–∏—è

#### 1. **–®–∞–±–ª–æ–Ω–Ω–∞—è –°–∏—Å—Ç–µ–º–∞ –¢–∏–ø–æ–≤**
```cpp
template<typename T>
class TypedMetric : public Metric {
    // –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
};
```

**–ü–æ—á–µ–º—É –≤—ã–±—Ä–∞–Ω —ç—Ç–æ—Ç –ø–æ–¥—Ö–æ–¥:**
- **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏** - –∏—Å–∫–ª—é—á–∞–µ—Ç –æ—à–∏–±–∫–∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –∏–∑–±–µ–≥–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –≤—ã–∑–æ–≤—ã –≤ –≥–æ—Ä—è—á–∏—Ö –ø—É—Ç—è—Ö
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –Ω–æ–≤—ã–µ —Ç–∏–ø—ã –¥–æ–±–∞–≤–ª—è—é—Ç—Å—è –ø—Ä–æ—Å—Ç–æ–π –∏–Ω—Å—Ç–∞–Ω—Ü–∏–∞—Ü–∏–µ–π —à–∞–±–ª–æ–Ω–æ–≤

#### 2. **–ü–æ–ª–∏–º–æ—Ä—Ñ–Ω–∞—è –ë–∞–∑–æ–≤–∞—è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**
```cpp
class Metric {
public:
    virtual std::unique_ptr<MetricValue> getAccumulatedValue() const = 0;
    virtual void reset() = 0;
    // ...
};
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:**
- **–ï–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –º–µ—Ç—Ä–∏–∫
- **–ü–æ–ª–∏–º–æ—Ä—Ñ–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** –≤ runtime –±–µ–∑ –∑–Ω–∞–Ω–∏—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–∏–ø–æ–≤
- **–ü–∞—Ç—Ç–µ—Ä–Ω Bridge** –º–µ–∂–¥—É —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é –∏ –ø–æ–ª–∏–º–æ—Ä—Ñ–∏–∑–º–æ–º

### üîÑ –ü–æ—Ç–æ–∫ –î–∞–Ω–Ω—ã—Ö –∏ –û–±—Ä–∞–±–æ—Ç–∫–∞

#### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö:
```
–ü–æ—Ç–æ–∫–∏ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è ‚Üí MetricCollector ‚Üí –§–æ–Ω–æ–≤—ã–π –ü–æ—Ç–æ–∫ ‚Üí MetricWriter ‚Üí –§–∞–π–ª
    (–∑–∞–ø–∏—Å—å)         (–Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ)      (–æ–±—Ä–∞–±–æ—Ç–∫–∞)     (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ) (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ)
```

#### 3. **–ù–µ–±–ª–æ–∫–∏—Ä—É—é—â–∞—è –ó–∞–ø–∏—Å—å (Hot Path Optimization)**
```cpp
void MetricCollector::recordMetric(const std::string& name, T value) {
    // –ë—ã—Å—Ç—Ä—ã–π –ø–æ–∏—Å–∫ –º–µ—Ç—Ä–∏–∫–∏
    Metric* target_metric = findMetric(name);  // O(1) —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π
    
    // –ê—Ç–æ–º–∞—Ä–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
    target_metric->recordValue(value);         // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ç–æ–ª—å–∫–æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –º–µ—Ç—Ä–∏–∫–∏
    
    // –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç
    return;  // –ù–ï –ñ–î–ï–ú –∑–∞–ø–∏—Å–∏ –≤ —Ñ–∞–π–ª
}
```

**–ö–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã:**
- **–ú–µ–ª–∫–æ–≥—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏** - –∫–∞–∂–¥–∞—è –º–µ—Ç—Ä–∏–∫–∞ –∏–º–µ–µ—Ç —Å–≤–æ–π mutex
- **–û—Ç–ª–æ–∂–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - —Ç—è–∂–µ–ª–∞—è —Ä–∞–±–æ—Ç–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è** - –º–µ—Ç—Ä–∏–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è "–Ω–∞ –ª–µ—Ç—É" –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏

#### 4. **–§–æ–Ω–æ–≤–∞—è –û–±—Ä–∞–±–æ—Ç–∫–∞**
```cpp
void processMetrics() {
    while (running_) {
        auto start = steady_clock::now();
        
        collectCurrentMetrics();  // –°–æ–±–∏—Ä–∞–µ–º –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
        
        // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Ç–æ—á–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –≤ 1 —Å–µ–∫—É–Ω–¥—É
        sleep_for(flush_interval - (steady_clock::now() - start));
    }
}
```

**–ó–∞—á–µ–º –Ω—É–∂–µ–Ω —Ñ–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫:**
- **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏** - –∑–∞–ø–∏—Å—å –∏ I/O –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **–ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è –∑–∞–ø–∏—Å—å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–µ—Ç—Ä–∏–∫ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
- **–¢–æ—á–Ω—ã–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã** - –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–µ—Ä–∏–æ–¥–∏—á–Ω–æ—Å—Ç—å –∑–∞–ø–∏—Å–∏

### üîí –ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### 5. **–°—Ç—Ä–∞—Ç–µ–≥–∏—è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏**
```cpp
// –ò–µ—Ä–∞—Ä—Ö–∏—è –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ (–ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ deadlock)
1. MetricRegistry::registry_mutex_     // –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫ (—Ä–µ–¥–∫–æ)
2. TypedMetric::mutex_                 // –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π (—á–∞—Å—Ç–æ)  
3. MetricWriter::write_mutex_          // –ó–∞–ø–∏—Å—å –≤ —Ñ–∞–π–ª (–ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏)
```

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ –≤—ã–±–æ—Ä–∞:**
- **Shared_mutex –¥–ª—è —á—Ç–µ–Ω–∏—è** - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —á–∏—Ç–∞—Ç–µ–ª–∏, –æ–¥–∏–Ω –ø–∏—Å–∞—Ç–µ–ª—å
- **Fine-grained locking** - –º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Çention –º–µ–∂–¥—É –ø–æ—Ç–æ–∫–∞–º–∏
- **Lock-free –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ** - atomic –¥–ª—è —Ñ–ª–∞–≥–æ–≤ —Å–æ—Å—Ç–æ—è–Ω–∏—è

#### 6. **–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –¶–∏–∫–ª –ú–µ—Ç—Ä–∏–∫**
```cpp
// –¶–∏–∫–ª: –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ ‚Üí –ê–≥—Ä–µ–≥–∞—Ü–∏—è ‚Üí –ó–∞–ø–∏—Å—å ‚Üí –°–±—Ä–æ—Å
while (running_) {
    // 1. –ù–∞–∫–∞–ø–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è (–≤ –ø–æ—Ç–æ–∫–∞—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è)
    metric->recordValue(value);
    
    // 2. –ê–≥—Ä–µ–≥–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ (–≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ)
    auto aggregated = metric->getAccumulatedValue();
    
    // 3. –ó–∞–ø–∏—Å—ã–≤–∞–µ–º –≤ —Ñ–∞–π–ª
    writer->writeMetrics(entries);
    
    // 4. –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
    metric->reset();
}
```

### üìä –û–±—Ä–∞–±–æ—Ç–∫–∞ –†–∞–∑–ª–∏—á–Ω—ã—Ö –¢–∏–ø–æ–≤ –î–∞–Ω–Ω—ã—Ö

#### 7. **–£–º–Ω—ã–µ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –ê–≥—Ä–µ–≥–∞—Ü–∏–∏**
```cpp
template<typename T>
std::unique_ptr<MetricValue> TypedMetric<T>::getAccumulatedValue() const {
    if constexpr (std::is_floating_point_v<T>) {
        // –î–ª—è CPU —É—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –°–†–ï–î–ù–ï–ï –∑–Ω–∞—á–µ–Ω–∏–µ
        return std::make_unique<TypedMetricValue<T>>(accumulated_value_ / count_);
    } else {
        // –î–ª—è HTTP –∑–∞–ø—Ä–æ—Å–æ–≤ - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –°–£–ú–ú–£
        return std::make_unique<TypedMetricValue<T>>(accumulated_value_);
    }
}
```

**–ü–æ—á–µ–º—É —Ä–∞–∑–Ω—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:**
- **CPU –º–µ—Ç—Ä–∏–∫–∏** - —Å—Ä–µ–¥–Ω–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É
- **HTTP –º–µ—Ç—Ä–∏–∫–∏** - —Å—É–º–º–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å** - –º–æ–∂–Ω–æ –ª–µ–≥–∫–æ –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏

### üéØ –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –†–µ—à–µ–Ω–∏—è

#### 8. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –í—Ä–µ–º–µ–Ω–Ω—ã—Ö –ú–µ—Ç–æ–∫**
```cpp
std::string formatTimestamp(const TimePoint& tp) {
    auto time_t = system_clock::to_time_t(tp);
    auto ms = duration_cast<milliseconds>(tp.time_since_epoch()) % 1000;
    
    // –¢–æ—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: "2025-06-01 15:00:01.653"
    ss << put_time(localtime(&time_t), "%Y-%m-%d %H:%M:%S");
    ss << '.' << setfill('0') << setw(3) << ms.count();
}
```

#### 9. **–í–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
```cpp
bool MetricNameValidator::isValidName(const std::string& name) {
    if (name.empty()) return false;
    
    // –ó–∞–ø—Ä–µ—â–∞–µ–º –æ–ø–∞—Å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
    for (char c : name) {
        if (c == '"' || c == '\n' || c == '\r' || c < 32) {
            return false;
        }
    }
    return true;
}
```

### üîß –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

#### 10. **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –ü–∞—Ç—Ç–µ—Ä–Ω—ã**

**RAII (Resource Acquisition Is Initialization):**
```cpp
class ScopedMetricSystem {
    ScopedMetricSystem(const std::string& file) {
        manager_ = MetricSystemManager::create(file);
        manager_->start();  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫
    }
    
    ~ScopedMetricSystem() {
        manager_->stop();   // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
    }
};
```

**Factory Pattern:**
```cpp
class MetricSystemFactory {
    static std::unique_ptr<MetricCollector> createSystem(const std::string& file);
};
```

**Template Method Pattern:**
```cpp
class TypedMetric<T> : public Metric {
    // –ë–∞–∑–æ–≤—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º –≤ –±–∞–∑–æ–≤–æ–º –∫–ª–∞—Å—Å–µ
    // –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è —Ç–∏–ø–∞ –æ–ø–µ—Ä–∞—Ü–∏–∏ –≤ —à–∞–±–ª–æ–Ω–µ
};
```

**Observer Pattern (–Ω–µ—è–≤–Ω–æ):**
```cpp
// MetricCollector "–Ω–∞–±–ª—é–¥–∞–µ—Ç" –∑–∞ –º–µ—Ç—Ä–∏–∫–∞–º–∏ –∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ –∏—Ö –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
```

### ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### 11. **–ì–æ—Ä—è—á–∏–π –ü—É—Ç—å (Hot Path)**
```cpp
// –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø—É—Ç—å –∑–∞–ø–∏—Å–∏ –º–µ—Ç—Ä–∏–∫
void recordMetric(T value) {
    std::lock_guard<std::mutex> lock(mutex_);  // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
    accumulated_value_ += value;               // –ü—Ä–æ—Å—Ç–æ–µ —Å–ª–æ–∂–µ–Ω–∏–µ
    count_++;                                  // –ü—Ä–æ—Å—Ç–æ–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç
}  // –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
```

**–ü—Ä–∏–Ω—Ü–∏–ø—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏** - —Ç–æ–ª—å–∫–æ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Å–µ–∫—Ü–∏–π
- **–ò–∑–±–µ–≥–∞–Ω–∏–µ –∞–ª–ª–æ–∫–∞—Ü–∏–π** - –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏
- **–ë–∞—Ç—á–µ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏** - –≥—Ä—É–ø–ø–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è overhead

#### 12. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –û—à–∏–±–æ–∫**
```cpp
try {
    metric->recordValue(value);
} catch (const std::exception& e) {
    std::cerr << "Metric recording failed: " << e.what() << std::endl;
    // –ù–ï –ø–∞–¥–∞–µ–º, –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Ä–∞–±–æ—Ç—É
}
```

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫:**
- **Graceful degradation** - —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –ø—Ä–∏ —Å–±–æ—è—Ö –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –º–µ—Ç—Ä–∏–∫
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫** - –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –æ –ø—Ä–æ–±–ª–µ–º–∞—Ö –±–µ–∑ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–∏—Å—Ç–µ–º—ã
- **Exception safety** - —Å—Ç—Ä–æ–≥–∏–µ –≥–∞—Ä–∞–Ω—Ç–∏–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ

## –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 1. **–ë–∞–∑–æ–≤—ã–π –ü—Ä–∏–º–µ—Ä**
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—á–Ω–æ —Ç—Ä–µ–±—É–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
```cpp
metrics->recordCPU(0.97);              // 0.0 –¥–æ N (—è–¥–µ—Ä)
metrics->recordHTTPRequests(42);       // 0 –¥–æ INT_MAX
```

### 2. **–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω—ã–π –ü—Ä–∏–º–µ—Ä**
–î–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- 5 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∑–∞–ø–∏—Å—å –º–µ—Ç—Ä–∏–∫
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫

### 3. **–†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –ü—Ä–∏–º–µ—Ä**
–°–∏–º—É–ª—è—Ü–∏—è –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞:
- –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –º–µ–∂–¥—É –º–µ—Ç—Ä–∏–∫–∞–º–∏
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –Ω–∞–≥—Ä—É–∑–∫–∏
- –í—Å–ø–ª–µ—Å–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏


### –ò—Ç–æ–≥–æ–≤—ã–µ –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:
- ‚ö° **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**: O(1) –∑–∞–ø–∏—Å—å, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
- üîí **–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –ø–æ—Ç–æ–∫–æ–≤
- üîß **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –õ–µ–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ç–∏–ø–æ–≤ –º–µ—Ç—Ä–∏–∫
- üìù **–°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º**: 100% –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
- üöÄ **–ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É**: RAII, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è 
